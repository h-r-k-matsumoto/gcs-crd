# GCS CRD

This is implementation of [Kubernetes Custom Resrouce Definitions]((https://kubernetes.io/docs/concepts/extend-kubernetes/api-extension/custom-resources/#customresourcedefinitions)).<br>
The Goal is to opearation GCS as a resource of Kubernetes.

Remember that GKE has [Servive Broker](https://cloud.google.com/kubernetes-engine/docs/concepts/google-cloud-platform-service-broker).

Development using [Kubebuilder](https://book.kubebuilder.io/).

**It is still in development.**

# How to use

## Local Development 

### Prepare

- install [Kubebuilder](https://book.kubebuilder.io/).
- set `GOOGLE_APPLICATION_CREDENTIALS` environemt.Please see [here](https://cloud.google.com/docs/authentication/getting-started).

### Running

```
$ make install
$ make run
```

Please change the following part of the [manifest sample](./config/samples/storage_v1alpha1_gcs.yaml).

```
  bucketName: crd-gcs-example
  projectID: <<set-your-gcp-projectid>>
```

```
$ kubectl apply -f ./config/samples/
```

bucketName is crd target logical name.<br>
The actual bucket name is generated by the controller.<br>
e.g. logical name is `crd-gcs-example2`, actual name is ` crd-gcs-example2-cabjafbb-pllngz` .

## Deploy to  GKE.

### Prepare

- Please change service account key file in [manager.yaml](./config/default/manager/manager.yaml).<br>
Please see [here](https://cloud.google.com/docs/authentication/getting-started).

### Running

```
$ make deploy
```

Please change the following part of the [manifest sample](./config/samples/storage_v1alpha1_gcs.yaml).

```
  bucketName: crd-gcs-example
  projectID: <<set-your-gcp-projectid>>
```

```
$ kubectl apply -f ./config/samples/
```

bucketName is crd target logical name.<br>
The actual bucket name is generated by the controller.<br>
e.g. logical name is `crd-gcs-example2`, actual name is ` crd-gcs-example2-cabjafbb-pllngz` .
